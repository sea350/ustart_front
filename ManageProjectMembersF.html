<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>ustart</title>
	<link href="/ustart_front/css/normalize.min.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="/ustart_front/css/inbox.css">
    <link rel="stylesheet" href="/ustart_front/css/manageProject.css">
	<script src="/ustart_front/js/ascii-convert.js"></script>
	<script src="/ustart_front/js/manageProject.js"></script>
	<script type="text/javascript">
        $("#leftNavMessages").addClass("theActive");
	</script>
</head>

<body>
	<div id="centering" style="top: 0; padding-top: 5em; padding-bottom: 1em;">
		<div id="content">
			<div id="container-full">
				<div class="container-left">
					<h3 class="container-left-header" style="margin-bottom:0;">
						Projects
					</h3>
					<ul id="inbox-groups">
                        {{range $loop := .ListOfHeads}}
                        <!-- for loop for project list here -->
						<li class="inbox-group projectList" id="{{$loop.DocID}}">
                            <a href="/Projects/{{$loop.Username}}">
							<img class="inbox-icon" id="img{{$loop.DocID}}" src="" />
                            </a>
                            <span class="group-header">{{$loop.FirstName}}</span>
                            <span id="totalRequests{{$loop.DocID}}" class="badge pull-right">{{$loop.Notifications}}</span>
                            <script>
								$('img#img{{$loop.DocID}}').attr('src', {{$loop.Image}});
				            </script>    
						</li>
                        {{end}}
                        <script>
                            
                                //GET THE REQUESTS FOR A SPECIFIC PROJECT
                                $('.projectList').on( "click", function(e) {
                                    var projectID = e.currentTarget.id;
                                    $.ajax({
                                        type: 'GET',
                                        url: 'http://ustart.today:5000/LoadJoinRequests/',
                                        contentType: "application/json; charset=utf-8",
                                        data: {projID:projectID},
                                        success: function(data) {
                                            var temp = JSON.parse(data);
                                            if (temp != null){
                                                $("#totalRequests"+projectID).show();   
                                                $("#totalRequests"+projectID).text(temp.length);
                                                if ($('#request-groups').contents().length == 0){
                                                    for (i=0; i < temp.length; i++){
                                                        makeProjectApplications(temp[i].FirstName, temp[i].Image,temp[i].DocID,projectID,temp[i].Username);
                                                    }
                                                }
                                                else{
                                                    $("#request-groups").empty();
                                                     for (i=0; i < temp.length; i++){
                                                        makeProjectApplications(temp[i].FirstName, temp[i].Image,temp[i].DocID,projectID,temp[i].Username);
                                                    }
                                                }
                                            }
                                            else{
                                                $("#request-groups").empty();
                                            }
                                        },
                                        error: function(err) {
                                            console.log('Project failed: ');
                                            console.log(err);
                                        }
                                    });
                                });
                                //HANDLE ACCEPT REQUEST
                               $('body').on("click", ".y-btn", function(e) {
                                   e.preventDefault();
                                    var that = $(this);
                                    var temp = e.currentTarget.id;
                                    var usrID=temp.replace("accept", "");
                                    var projID = $(e.target).closest('.parentID').attr('id');
                                    var totalReq = $("#totalRequests"+projID).text();
                                    that.off('click'); // remove handler
                                   $.ajax({
                                        type: 'GET',
                                        url: 'http://ustart.today:5000/AcceptJoinRequest/',
                                        contentType: "application/json; charset=utf-8",
                                        data: {userID:usrID, projectID: projID},
                                        success: function(result) {
                                            //update notification
                                             var testresult = parseInt(result);
                                             if (testresult <=0){
                                                $("#totalRequests"+projID).hide();    
                                             }
                                             else{
                                                $("#totalRequests"+projID).text(testresult);
                                             }
                                            $("#"+usrID).empty();
                                            $("#"+usrID).remove();
                                        },
                                        error: function(err) {
                                            console.log('Request failed: ');
                                            console.log(err);
                                        }
                                     }).always(function() {
                                            that.on('click', login); // add handler back after ajax
                                     });
                                });
                                $('body').on("click", ".x-btn", function(e) {
                                    e.preventDefault();
                                    var that = $(this);
                                    var temp = e.currentTarget.id;
                                    var usrID=temp.replace("reject", "");
                                    var projID = $(e.target).closest('.parentID').attr('id');
                                    var totalReq = $("#totalRequests"+projID).text();
                                    that.off('click'); // remove handler
                                     $.ajax({
                                        type: 'GET',
                                        url: 'http://ustart.today:5000/RejectJoinRequest/',
                                        contentType: "application/json; charset=utf-8",
                                        data: {userID:usrID, projectID: projID},
                                        success: function(result) {
                                             var testresult = parseInt(result);
                                             if (testresult <=0){
                                                $("#totalRequests"+projID).hide();    
                                             }
                                             else{
                                                $("#totalRequests"+projID).text(testresult);
                                             }
                                            $("#"+usrID).empty();
                                            $("#"+usrID).remove();
                                        },
                                        error: function(err) {
                                            console.log('Request failed: ');
                                            console.log(err);
                                        }
                                     }).always(function() {
                                            that.on('click', login); // add handler back after ajax
                                     });
                                });
                        </script>
                        <!-- end for loop -->
					</ul>
				</div>
				<div class="container-right">
					<div id="0" class="box-chat">
						<h3 class="message-head">Requests
                        <!-- member bar feature hidden
                        <a id="sidebarCollapse" style="float:right;">
				            <i class="fa fa-angle-double-left" style="color:#00ac7d;"></i>
						</a>
                        -->
                        </h3>
                        <div class="box-section">
							<div class="inner-section-left">
                                 <ul id="request-groups">
                                    <!-- example code for request of project 
                                    <li class="inbox-group active">
                                        <div class="input-group-btn" style="float:right; width:auto;">
                                            <button class="btn btn-default" type="submit">
                                                <i class="glyphicon glyphicon-ok" style="color:#607d8b;"></i>
                                            </button>
                                            <button class="btn btn-default" type="submit">
                                                <i class="glyphicon glyphicon-remove" style="color:#607d8b;"></i>
                                            </button>
                                        </div>
                                        <img class="inbox-icon" src="img/img1.png" />
                                        <span class="group-header">Bob </span>
                                        <br>
                                        <span class="invitation-message">would like you join your project UStart!</span>
                                    </li>
                                 end example -->
                                </ul>
                            </div>
                            <!--
                            <div class="section-right">
								<div class="wrapper">
                                    <nav id="sidebar">
                                           <div class="sidebar-header">
                                               <div class="projectMembers">R</div>
                                               <strong>Ryan Rozbiani <a href="#"><i class="fa fa-sign-out"></i></a></strong>
                                            </div>
                                            <div class="sidebar-header">
                                               <div class="projectMembers">C</div>
                                               <strong>Cyka Blyat <a href="#"><i class="fa fa-sign-out"></i></a></strong>
                                            </div>
                                    </nav>

                                </div>
							</div>
                            -->
                        </div>
					</div>	
				</div>
			</div>
		</div>
	</div>
	<footer id="foot"></footer>
	<script src="/ustart_front/js/fadebody.js"></script>
</body>

</html>
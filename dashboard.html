<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>ustart</title>
    <link rel="stylesheet" type="text/css" href="/ustart_front/css/dashboard.css">
    <link rel="stylesheet" type="text/css" href="/ustart_front/css/normalize.min.css">
    <script src="/ustart_front/js/ascii-convert.js"></script>
    <script src="/ustart_front/js/dashload.js"></script>
    <script src="/ustart_front/js/createpost2.js"></script>
    <script>
        var dashTotalHits;
        var dashScrollID;
        var dashflag=0;
        $(document).ready(function (){
            $("#leftNavDash").addClass("theActive");
        });
    </script>
</head>
<body>
    <div id="centering">
        <div id ="commentModals"></div>
        <div id ="shareModals"></div>
        <div id="content">
            <div class="container">
            <div class="row">
                <div class="col-md-2"></div>
                <div id ="dash-posts" class="col-md-6">
                </div>
                 <script>
                    $.ajax({
                            type: 'GET',
                            url: 'http://ustart.today:'+port+'/AjaxDash/',
                            contentType: "application/json; charset=utf-8",
                            data: {},
                            success: function(data) {
                            },complete: function (jqXHR,status) {
                                if(status == 'success' || status=='notmodified')
                                {
                                var temp = $.parseJSON(jqXHR.responseText);
                                    dashTotalHits=temp.TotalHits;
                                    dashScrollID = temp.ScrollID;
                                    if (temp != null){
                                        for (i=0; i < temp.JournalEntries.length; i++){
                                            makeDashPostApplications(temp.JournalEntries[i].ElementID, temp.JournalEntries[i].Username,temp.JournalEntries[i].FirstName, temp.JournalEntries[i].LastName, temp.JournalEntries[i].Image, temp.JournalEntries[i].Element.Content,temp.JournalEntries[i].Element.TimeStamp, temp.JournalEntries[i].NumLikes, temp.JournalEntries[i].NumReplies, temp.JournalEntries[i].NumShares);
                                        }
                                    }
                                }
                            }
                            ,error: function(err) {
                                console.log('chat initial chat failed: ');
                                console.log(err);
                            }
                    });
                </script>
                <div class="col-md-2">
                    <div id="suggestedUser">
                        <div class="dashboard panel panel-default">
                            <div id="dash-header">
                                <h4 style="padding-left: 10px;">Suggested Users</h4>
                                <div class="suggested-users-cont">
                                    <div class="user-card">
                                        <div class="dismiss">
                                            <span id="dismiss">&times;</span>
                                        </div>
                                        <div class="content">
                                            <img class="avatar" src="http://engineering.nyu.edu/files/imagecache/profile_full/pictures/picture-126.jpg">
                                            <div class="user-card-info">
                                                <a href="profile.html">
                                                        <strong class="user-card-name">Fred Strauss</strong>
                                                    </a>
                                                <br/>
                                                <button id="btn-small" class="btn btnX" rel="6">Follow</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="user-card">
                                        <div class="dismiss">
                                            <span id="dismiss">&times;</span>
                                        </div>
                                        <div class="content">
                                            <img class="avatar" src="http://engineering.nyu.edu/files/imagecache/img_half/ftp/images/mdabaie/sterling_john2.jpg">
                                            <div class="user-card-info">
                                                <a href="profile.html">
                                                        <strong class="user-card-name">John Sterling</strong>
                                                    </a>
                                                <br/>
                                                <button id="btn-small" class="btn btnX" rel="6">Follow</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="user-card">
                                        <div class="dismiss">
                                            <span id="dismiss">&times;</span>
                                        </div>
                                        <div class="content">
                                            <img class="avatar" src="http://engineering.nyu.edu/files/imagecache/profile_full/pictures/picture-341.jpg">
                                            <div class="user-card-info">
                                                <a href="profile.html">
                                                        <strong class="user-card-name">Haldun Hadimioglu</strong>
                                                    </a>
                                                <br/>
                                                <button id="btn-small" class="btn btnX" rel="6">Follow</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="suggestedProj" class="margin-top">
                        <div class="dashboard panel panel-default">
                            <div id="dash-header">
                                <h4 style="padding-left: 10px;">Suggested Projects</h4>
                                <div class="suggested-projects-cont">
                                    <div class="proj-card">
                                        <div class="dismiss">
                                            <span id="dismiss">&times;</span>
                                        </div>
                                        <div class="content">
                                            <img class="avatar" src="https://pbs.twimg.com/profile_images/898391736078262272/oHO_LQmH_400x400.jpg">
                                            <div class="proj-card-info">
                                                <a href="projects.html">
                                                        <strong class="proj-card-name">U‚óèStart </strong>
                                                    </a>
                                                <br/>
                                                <button id="btn-small" class="btn btnY" rel="6">Follow</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="proj-card">
                                        <div class="dismiss">
                                            <span id="dismiss">&times;</span>
                                        </div>
                                        <div class="content">
                                            <img class="avatar" src="https://pbs.twimg.com/profile_images/758427355920621568/8ouHUoFi_400x400.jpg">
                                            <div class="proj-card-info">
                                                <a href="projects.html">
                                                        <strong class="proj-card-name">NYU Future Labs</strong>
                                                    </a>
                                                <br/>
                                                <button id="btn-small" class="btn btnY" rel="6">Follow</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="proj-card">
                                        <div class="dismiss">
                                            <span id="dismiss">&times;</span>
                                        </div>
                                        <div class="content">
                                            <img class="avatar" src="https://pbs.twimg.com/profile_images/773317101012586496/q8sc1KuZ_400x400.jpg">
                                            <div class="proj-card-info">
                                                <a href="projects.html">
                                                        <strong class="proj-card-name">TensorFlow</strong>
                                                    </a>
                                                <br/>
                                                <button id="btn-small" class="btn btnY" rel="6">Follow</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                </div><!-- end row -->
                <script>

                         function element_in_scroll(elem)
                         {
                            var docViewTop = $(window).scrollTop();
                            var docViewBottom = docViewTop + $(window).height();
                            var elemTop = $(elem).offset().top;
                            var elemBottom = elemTop + $(elem).height();
                            return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
                         }
                        (function($, window, undefined) {
                            var InfiniteScroll = function() {
                                this.initialize = function() {
                                    this.setupEvents();
                                };

                                this.setupEvents = function() {
                                    $(window).on(
                                        'scroll',
                                        this.handleScroll.bind(this)
                                    );
                                };

                                this.handleScroll = function() {
                                    var scrollTop = $(document).scrollTop();
                                    var windowHeight = $(window).height();
                                    var height = $(document).height() - windowHeight;
                                    var scrollPercentage = (scrollTop / height);

                                    // if the scroll is more than 90% from the top, load more content.
                                    if(scrollPercentage > 0.95) {
                                        this.doSomething();
                                    }
                                }

                                this.doSomething = function() {    
                                    // Do something.
                                    console.log("here");
                                  if (dashflag == 1){
                                         var url = document.createElement('a');
                                         url.href = window.location.href;
                                         var temp = parseQuery(url.search);
                                         dashflag=0;
                                         if ( $('.feedPost').length < dashTotalHits){
                                             console.log("here2")
                                             $.ajax({
                                                type: 'GET',
                                                url: 'http://ustart.today:'+port+'/AjaxDash/',
                                                contentType: "application/json; charset=utf-8",
                                                data: {scrollID: dashScrollID},
                                                success: function(data) {  
                                                },complete: function (jqXHR,status) {
                                                     dashflag=1;
                                                     if(status == 'success' || status=='notmodified')
                                                     {
                                                        var temp = $.parseJSON(jqXHR.responseText);
                                                        if(temp != null){
                                                          console.log(temp);
                                                        }
                                                     }
                                                },error: function(err) {
                                                    console.log('chat Load failed: ');
                                                    console.log(err);
                                                }
                                            });
                                        }
                                       else dashflag=1;   
                                 }
                                }

                                this.initialize();
                            }

                            $(document).ready(function() {// Initialize scroll
                                    new InfiniteScroll();
                            });
                        })(jQuery, window);
                </script>
            </div>
            </div>
        </div>
    </div>
</body>

</html>
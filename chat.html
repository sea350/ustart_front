<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>ustart</title>
	<link rel="stylesheet" href="/ustart_front/css/inbox.css">
	<script src="/ustart_front/js/inbox.js"></script>
    <script>
        var sockets = [];
    </script>
</head>
<body>
   <div id="centering" style="top: 0; padding-top: 5em; padding-bottom: 1em; width:80%; margin: 0 auto;">
       <div id="content">
			<div id="container-full">
				<div class="container-left">
					<h3 class="container-left-header">
						Messages
					</h3>
					<div class="input-group inbox-search-box">
                        <input type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" placeholder="Search">
                        <span class="input-group-addon">
                            <button class="btn btn-default" type="button"><i class="glyphicon glyphicon-search"></i></button>
                       </span>
					</div>
					<br/>
					<ul id="inbox-groups">
                        <!-- sample chat -->
						<li class="inbox-group active">
                            <div class="inbox-image"><img class="inbox-icon" src="img/img1.png"/></div>
							<div class="inbox-side-content">
                                <div class = "inbox-left-bar">
                                    <div class = "inbox-header">
                                    <span class="group-header" >Pikachu Chat</span>
                                    </div>
                                    <div class = "inbox-timestamp">
                                    <span class="group-message-time">5:00 PM</span>
                                    </div>
                                </div>
                                <div class = "inbox-last-msg">
                                <span class="group-message">Pikachu: Pika Chuu!</span>
                                </div>
                            </div>
						</li>
                        <!-- -->
					</ul>
				</div>
				<div class="container-right">
					<div id="0" class="box-chat">
						<h3 class="message-head">Chat
                        <!-- collapsable member list -->
                        <a id="sidebarCollapse" data-toggle="tooltip" data-placement="top" title="Members" style="float:right;">
				            <i class="fa fa-angle-double-left" style="color:#00ac7d;"></i>
						</a>
                        </h3>
						<div class="box-section">
							<div class="section-left">
								<ul class="message-box">
									<script>
                                        $( document ).ready(function() {
                                            if(!("WebSocket" in window)){
                                                console.log("you need a browser that supports web sockets")
                                             }else{
                                                 try{
                                                    for(var s in sockets){
                                                        s.close();
                                                    }
                                                    var socket = new WebSocket('ws://' + window.location.host + '/ws/');
                                                    socket.onopen = function(){
                                                        console.log('Socket Status: '+socket.readyState+'(open)');
                                                        sockets.push(socket);
                                                    }
                                                    socket.onmessage = function(e){
                                                        //replace later
                                                        var sender ="Mother Russia";
                                                        console.log('Received: '+e.data);
                                                        var timeNow = new Date().getTime();
                                                        var msg = JSON.parse(e.data);
                                                        if(msg.DocID == {{.DOCID}}){
                                                            var senderCheck = true;
                                                        }
                                                        else{
                                                            var senderCheck = false;
                                                        }
                                                        populateMessage(Math.floor(Math.random() * 99999), sender,
			                                            msg.Message, 'img/img1.png', timeNow, senderCheck);
                                                        $('.inbox-group.active .group-message').text(sender+": "+msg.message);
			                                            $('.inbox-group.active .group-message-time').text(formatTime(timeNow));
                                                        $('.message-box').scrollTop($('.message-box')[0].scrollHeight);
                                                    }
                                                    $('.inputMessages').keydown(function (e) {
                                                        if (e.keyCode == 13) {
                                                            $('#chat-submit-btn').click();
                                                        }
                                                    });
                                                    $('.chat-submit').click(function(e) {
                                                        if ($('#messager').val().length > 0) {
                                                            var timeNow = new Date().getTime();                                       
                                                            socket.send(JSON.stringify({
                                                                Message: $('#messager').val()
                                                            }));
                                                            $('#messager').val('');
                                                            $('.message-box').scrollTop($('.message-box')[0].scrollHeight);
                                                        }
                                                    });
                                                 }
                                                 catch(exception){
                                                     console.log('Error: '+exception);
                                                }
                                             }
                                            
                                        });
                                    </script>
								</ul>
								<div class="message-foot">
                                    <div class="input-group col-xs-12">
                                        <!-- --------message input ------------------------------------------------------->
                                        <input id="messager" class="form-control inputMessages" type="text" placeholder="Message here" autocomplete='off' autofocus />
                                        <span class="input-group-addon">
                                            <button class="btn btn-default chat-submit" id="chat-submit-btn" type="submit">
                                               <i class="glyphicon glyphicon-chevron-right"></i>
                                            </button>
                                        </span>
                                    </div>
								</div>
							</div>
							<div class="section-right">
								<div class="wrapper">
                                    <nav id="sidebar">
                                           <div class="sidebar-header">
                                               <div class="projectMembers">R</div>
                                               <strong>Ryan Rozbiani</strong>
                                            </div>
                                    </nav>
                                </div>
							</div>
						</div>
					</div>
					<div class="box-compose">
						<form id="composer-form">
							<div class="input-group col-xs-12">
								<span class="input-group-addon">To</span>
								<input id="composer" class="form-control" type="text" placeholder="Person or Group" autocomplete='off' autofocus />
								<span class="input-group-btn">
									<button class="btn btn-default"><i class="glyphicon glyphicon-chevron-right"></i></button>
								</span>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
    </div>
    <footer id="foot"></footer>
    <script src="/ustart_front/js/fadebody.js"></script>
</body>
</html>